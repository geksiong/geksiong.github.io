<!DOCTYPE html><link rel="stylesheet" href="/assets/a65afd8b.4fbfad6d.css" />
<link rel="stylesheet" href="/assets/61ac98b4.eaf02831.css" />
<link rel="stylesheet" href="/assets/3aa4f882.10421762.css" /><script type="module">
</script><html lang="en" class="scroll-pt-20">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Jenkins Cookbook</title>

  <!-- KaTeX stylesheet -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/a65afd8b.4fbfad6d.css" />
<link rel="stylesheet" href="/assets/61ac98b4.eaf02831.css" />
<link rel="stylesheet" href="/assets/3aa4f882.10421762.css" /><script type="module">
</script></head>

	<body class="theme-default typography-default font-body bg-background">
		<div class="subpixel-antialiased text-darkshade">
			<div class="flex flex-col min-h-screen space-y-12">
				

<header class="container sticky top-0 z-50 flex items-center justify-between w-full max-w-3xl px-6 py-4 mx-auto xl:max-w-5xl text-darkshade bg-lightshade astro-FT2W3FBR">
	<a href="/" class="block h-6 text-2xl font-semibold hover:text-main astro-FT2W3FBR">
		<img src="https://s.gravatar.com/avatar/f4fc421dae2d7fc4b8b66112f838f881?s=80" class="inline-block h-8 astro-FT2W3FBR"><span class="hidden pl-2 sm:inline-block astro-FT2W3FBR">Production Not Ready</span>
	</a>

	<div class="flex items-center astro-FT2W3FBR">
		<!-- Main navigation -->
		<nav class="hidden space-x-2 font-medium sm:block astro-FT2W3FBR">
			<a href="/posts" class="p-1 hover:border-b-4 hover:border-main hover:text-main astro-FT2W3FBR">Posts</a><a href="/posts/tags" class="p-1 hover:border-b-4 hover:border-main hover:text-main astro-FT2W3FBR">Tags</a><a href="/website" class="p-1 hover:border-b-4 hover:border-main hover:text-main astro-FT2W3FBR">About</a><a href="/geksiong" class="p-1 hover:border-b-4 hover:border-main hover:text-main astro-FT2W3FBR">Bio</a>
		</nav>

		<!-- Dark Mode toggle -->
		<!--button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4 hover:text-main">
			<Icon name="tabler:moon" class="w-6"/>
		</button -->

		<!-- Mobile menu toggle -->
		<div class="sm:hidden astro-FT2W3FBR">
			<button type="button" aria-label="Toggle Menu" class="w-8 h-8 ml-1 mr-1 rounded astro-FT2W3FBR" onclick="toggleMobileMenu()">
				<svg viewBox="0 0 24 24" id="menuOpenBtn" class="w-6 astro-FT2W3FBR" astro-icon="tabler:menu"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M4 8h16M4 16h16"/></g></svg>
				<svg viewBox="0 0 24 24" id="menuCloseBtn" class="hidden w-6 astro-FT2W3FBR" astro-icon="tabler:x"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M18 6 6 18M6 6l12 12"/></g></svg>
			</button>
		</div>
	</div>

	<!-- Mobile menu -->
	<div id="mobile_menu" class="fixed right-0 z-10 w-1/2 h-full duration-300 ease-in-out transform top-16 bg-darkshade text-lightshade hideMenu astro-FT2W3FBR">
		<nav class="fixed h-full mt-8 astro-FT2W3FBR">
			<div class="px-12 py-2 astro-FT2W3FBR">
					<a href="/posts" class="text-2xl font-bold tracking-widest astro-FT2W3FBR">Posts</a>
				</div><div class="px-12 py-2 astro-FT2W3FBR">
					<a href="/posts/tags" class="text-2xl font-bold tracking-widest astro-FT2W3FBR">Tags</a>
				</div><div class="px-12 py-2 astro-FT2W3FBR">
					<a href="/website" class="text-2xl font-bold tracking-widest astro-FT2W3FBR">About</a>
				</div><div class="px-12 py-2 astro-FT2W3FBR">
					<a href="/geksiong" class="text-2xl font-bold tracking-widest astro-FT2W3FBR">Bio</a>
				</div>
		</nav>
	</div>

</header>


				<main class="container flex-1 max-w-3xl px-6 mx-auto xl:max-w-5xl">
					<link rel="stylesheet" href="/assets/a65afd8b.4fbfad6d.css" />
<link rel="stylesheet" href="/assets/61ac98b4.eaf02831.css" />
<link rel="stylesheet" href="/assets/3aa4f882.10421762.css" /><script type="module">
</script><article class="pb-8 space-y-6 md:space-y-8">

		<div class="flex flex-wrap space-x-3 font-semibold">
			<a href="/posts/tags/jenkins" class="p-1 text-sm tracking-wider uppercase rounded-md text-main hover:bg-main/20">jenkins</a><a href="/posts/tags/tech-notes" class="p-1 text-sm tracking-wider uppercase rounded-md text-main hover:bg-main/20">tech notes</a>
		</div>

		<h1 class="text-3xl font-bold font-heading md:tracking-normal md:text-4xl">Jenkins Cookbook</h1>

		<div class="text-xl font-leading text-darkshade/75">Some declarative pipelines I&#39;ve used for Jenkins</div>

		<div class="flex flex-col items-start justify-between md:flex-row md:items-center">
			<div class="flex items-center space-x-2">
				<img src="https://s.gravatar.com/avatar/f4fc421dae2d7fc4b8b66112f838f881?s=80" alt="" class="w-12 h-12 border-2 rounded-full shadow-lg border-lightshade">
				<p class="text-sm">
					<span class="font-semibold">GS Low</span>
					<br><span class="text-darkshade/50">Thu Nov 01 2018</span>
				</p>
			</div>
		</div>

    <div class="flex flex-col sm:flex-row-reverse">
			<aside class="w-full pb-8 pl-6 sm:w-1/4 not-prose">
		  <nav class="text-sm">
					<div>
						<h2 class="pb-4 text-sm font-semibold tracking-widest uppercase md:border-l-2 md:px-4 ">On This Page</h2>
						<div class="flex flex-col">
							<div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#basic-declarative-pipeline" class="block w-full">Basic Declarative Pipeline</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#checkout-from-git-with-credentials-not-needed-for-multi-branch-pipelines" class="block w-full">Checkout from git with credentials (not needed for multi-branch pipelines)</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#poll-git-for-changes-regularly-not-needed-for-multi-branch-pipelines" class="block w-full">Poll git for changes regularly (not needed for multi-branch pipelines)</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#ansicolor-output" class="block w-full">AnsiColor output</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#set-environment-variables-various-ways" class="block w-full">Set environment variables (various ways)</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#inject-jenkins-credentials-into-environment-variable" class="block w-full">Inject Jenkins credentials into environment variable</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#select-jdk-and-maven-version-defined-in-jenkins" class="block w-full">Select JDK and Maven version (defined in Jenkins)</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#ignore-exit-code-while-inside-a-shell-step" class="block w-full">Ignore exit code while inside a shell step</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#ignore-exit-code-from-a-shell-step-and-capture-it" class="block w-full">Ignore exit code from a shell step (and capture it)</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#mark-pipeline-as-failed-when-a-stage-is-unstable" class="block w-full">Mark pipeline as failed when a stage is unstable</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#run-sonarqube-analysis" class="block w-full">Run SonarQube analysis</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#archive-buildtest-artifacts" class="block w-full">Archive build/test artifacts</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#sending-notification-to-email--slack" class="block w-full">Sending notification to Email / Slack</a></div></div><div class="md:border-l-2 md:px-4 md:py-1 hover:text-main hover:border-main hover:bg-main/20"><div style=""><a href="#invoke-owasp-dependency-check-scan" class="block w-full">Invoke OWASP Dependency Check scan</a></div></div>
						</div>
					</div>
				</nav>
			</aside>

			<div class="w-full prose sm:w-3/4 max-w-none">
				<h1 id="basic-declarative-pipeline">Basic Declarative Pipeline</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">pipeline {</span></span>
<span class="line"><span style="color: #C9D1D9">    agent any</span></span>
<span class="line"><span style="color: #C9D1D9">    stages {</span></span>
<span class="line"><span style="color: #C9D1D9">        stage(</span><span style="color: #A5D6FF">'checkout'</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            steps {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #8B949E">// Steps here</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        stage(</span><span style="color: #A5D6FF">'build'</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            steps {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #8B949E">// Steps here</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        stage(</span><span style="color: #A5D6FF">'tests'</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            parallel {</span></span>
<span class="line"><span style="color: #C9D1D9">                stage(</span><span style="color: #A5D6FF">'AAA'</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    steps {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #8B949E">// ...</span></span>
<span class="line"><span style="color: #C9D1D9">                        }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">                stage(</span><span style="color: #A5D6FF">'BBB'</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    steps {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #8B949E">// ...    </span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    post {</span></span>
<span class="line"><span style="color: #C9D1D9">        always {</span></span>
<span class="line"><span style="color: #C9D1D9">            echo </span><span style="color: #A5D6FF">'One way or another, I have finished'</span></span>
<span class="line"><span style="color: #C9D1D9">            deleteDir() </span><span style="color: #8B949E">/* clean up our workspace */</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        success {</span></span>
<span class="line"><span style="color: #C9D1D9">            echo </span><span style="color: #A5D6FF">'I succeeeded!'</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        unstable {</span></span>
<span class="line"><span style="color: #C9D1D9">            echo </span><span style="color: #A5D6FF">'I am unstable :/'</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        failure {</span></span>
<span class="line"><span style="color: #C9D1D9">            echo </span><span style="color: #A5D6FF">'I failed :('</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        changed {</span></span>
<span class="line"><span style="color: #C9D1D9">            echo </span><span style="color: #A5D6FF">'Things were different before...'</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<h1 id="checkout-from-git-with-credentials-not-needed-for-multi-branch-pipelines">Checkout from git with credentials (not needed for multi-branch pipelines)</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">        stage('checkout') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                git url: '&#x3C;git url>', branch: '&#x3C;branch>', credentialsId: '&#x3C;jenkins credId>'</span></span>
<span class="line"><span style="color: #c9d1d9">                // ...</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span></code></pre>
<h1 id="poll-git-for-changes-regularly-not-needed-for-multi-branch-pipelines">Poll git for changes regularly (not needed for multi-branch pipelines)</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">pipeline {</span></span>
<span class="line"><span style="color: #c9d1d9">    agent any</span></span>
<span class="line"><span style="color: #c9d1d9">    triggers { pollSCM('H 07 * * 1') }</span></span>
<span class="line"><span style="color: #c9d1d9">    stages {</span></span>
<span class="line"><span style="color: #c9d1d9">        stage('checkout') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                git url: '&#x3C;git url>', branch: '&#x3C;branch>', credentialsId: '&#x3C;jenkins credId>', poll: true</span></span>
<span class="line"><span style="color: #c9d1d9">                // ...</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span>
<span class="line"><span style="color: #c9d1d9">    }</span></span></code></pre>
<h1 id="ansicolor-output">AnsiColor output</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">        stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                ansiColor('xterm') {</span></span>
<span class="line"><span style="color: #c9d1d9">                    // ...  </span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">	}</span></span></code></pre>
<h1 id="set-environment-variables-various-ways">Set environment variables (various ways)</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">    stages {</span></span>
<span class="line"><span style="color: #c9d1d9">        environment {</span></span>
<span class="line"><span style="color: #c9d1d9">            GLOBALVAR = 'this is a global variable'</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span>
<span class="line"><span style="color: #c9d1d9">        stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">            environment {</span></span>
<span class="line"><span style="color: #c9d1d9">                 STAGEVAR = 'this is a stage variable'</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">	        script {</span></span>
<span class="line"><span style="color: #c9d1d9">                    env.MYVAR = "my variable"</span></span>
<span class="line"><span style="color: #c9d1d9">                    env.VAR = "the value of MYVAR is ${env.MYVAR}"</span></span>
<span class="line"><span style="color: #c9d1d9">                    env.VARFROMPROGRAM = sh(returnStdout:true, script: "&#x3C;run a program and even use ${env.VAR} here>").trim()</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span>
<span class="line"><span style="color: #c9d1d9">    }</span></span></code></pre>
<h1 id="inject-jenkins-credentials-into-environment-variable">Inject Jenkins credentials into environment variable</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">        stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                withCredentials([usernameColonPassword(credentialsId: '&#x3C;jenkins credId', variable: 'USERPASS')]) {</span></span>
<span class="line"><span style="color: #c9d1d9">                    sh "echo $USERPASS"</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span></code></pre>
<h1 id="select-jdk-and-maven-version-defined-in-jenkins">Select JDK and Maven version (defined in Jenkins)</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">        stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                withEnv(["JAVA_HOME=${tool 'JDK 8'}","PATH+MAVEN=${tool 'Maven 3'}/bin:${env.JAVA_HOME}/bin"]) {</span></span>
<span class="line"><span style="color: #c9d1d9">                    sh "mvn -Dmaven.test.skip=true clean package"</span></span>
<span class="line"><span style="color: #c9d1d9">                    // ...</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span></code></pre>
<h1 id="ignore-exit-code-while-inside-a-shell-step">Ignore exit code while inside a shell step</h1>
<p>A shell step invokes bash with -xe options. Setting +e will disable immediate exit from an earlier failed step. Note that the earlier exit code will always be 0. If your intent is to capture the exit code but not fail the step, then see the next section.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">                stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">                    steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                        sh """</span></span>
<span class="line"><span style="color: #c9d1d9">                            set +e</span></span>
<span class="line"><span style="color: #c9d1d9">                            // do something...</span></span>
<span class="line"><span style="color: #c9d1d9">                            set -e</span></span>
<span class="line"><span style="color: #c9d1d9">			    // this line will run regardless of previous exit code</span></span>
<span class="line"><span style="color: #c9d1d9">                        """</span></span>
<span class="line"><span style="color: #c9d1d9">                    }</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span></code></pre>
<h1 id="ignore-exit-code-from-a-shell-step-and-capture-it">Ignore exit code from a shell step (and capture it)</h1>
<p>The shell step comes with a returnStatus option that will return the exit code and won’t fail the step. This means you can capture the exit code and then defer the decision to fail the pipeline toward the end of the pipeline.</p>
<p>Note: for some reason, using environment variables will not work</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">def pipeline_should_fail = false</span></span>
<span class="line"><span style="color: #c9d1d9">pipeline {</span></span>
<span class="line"><span style="color: #c9d1d9">    ....</span></span>
<span class="line"><span style="color: #c9d1d9">        stage('AAA') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                script {</span></span>
<span class="line"><span style="color: #c9d1d9">                    def step_result = sh (returnStatus: true, script: """</span></span>
<span class="line"><span style="color: #c9d1d9">                        // do something</span></span>
<span class="line"><span style="color: #c9d1d9">                    """)</span></span>
<span class="line"><span style="color: #c9d1d9">		    if (step_result != 0) { pipeline_should_fail = true }</span></span>
<span class="line"><span style="color: #c9d1d9">                    sh """</span></span>
<span class="line"><span style="color: #c9d1d9">                        echo 'this line will run'</span></span>
<span class="line"><span style="color: #c9d1d9">                    """</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">	}</span></span>
<span class="line"><span style="color: #c9d1d9">	// other stages</span></span>
<span class="line"><span style="color: #c9d1d9">	</span></span>
<span class="line"><span style="color: #c9d1d9">        post {</span></span>
<span class="line"><span style="color: #c9d1d9">            always {</span></span>
<span class="line"><span style="color: #c9d1d9">	        // fail the pipeline if the earlier stage failed</span></span>
<span class="line"><span style="color: #c9d1d9">                script {</span></span>
<span class="line"><span style="color: #c9d1d9">                    if (pipeline_should_fail) {</span></span>
<span class="line"><span style="color: #c9d1d9">                        currentBuild.result = "FAILURE"</span></span>
<span class="line"><span style="color: #c9d1d9">                    }</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span></code></pre>
<h1 id="mark-pipeline-as-failed-when-a-stage-is-unstable">Mark pipeline as failed when a stage is unstable</h1>
<p>The post block is placed as the last step in a stage.</p>
<p>A stage is usually unstable when a Jenkins publisher determine so e.g. JUnit test has failures</p>
<p>You cannot mark a build as successful from unstable status.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">            post {</span></span>
<span class="line"><span style="color: #c9d1d9">                unstable {</span></span>
<span class="line"><span style="color: #c9d1d9">                    script {</span></span>
<span class="line"><span style="color: #c9d1d9">                        echo "Problems encountered, marking build as FAILED"</span></span>
<span class="line"><span style="color: #c9d1d9">                        currentBuild.result = 'FAILURE'</span></span>
<span class="line"><span style="color: #c9d1d9">                    }</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span></code></pre>
<h1 id="run-sonarqube-analysis">Run SonarQube analysis</h1>
<p>Requires SonarQube plugin</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">               stage('sonar') {</span></span>
<span class="line"><span style="color: #c9d1d9">                    steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                        withSonarQubeEnv('Sonar') {</span></span>
<span class="line"><span style="color: #c9d1d9">                            script {</span></span>
<span class="line"><span style="color: #c9d1d9">                                def sonar = tool name: 'Sonar Runner', type: 'hudson.plugins.sonar.SonarRunnerInstallation'</span></span>
<span class="line"><span style="color: #c9d1d9">                                sh """</span></span>
<span class="line"><span style="color: #c9d1d9">                                $sonar/bin/sonar-scanner -e -Dsonar.host.url=${SONAR_HOST_URL} -Dsonar.login=${SONAR_AUTH_TOKEN} \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.projectName='&#x3C;project name>' \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.projectVersion=&#x3C;version> \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.projectKey=&#x3C;project key> \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.sources=&#x3C;sources paths, no wildcards> \</span></span>
<span class="line"><span style="color: #c9d1d9">				    -Dsonar.inclusions=&#x3C;inclusions paths, wildcards ok> \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.exclusions=&#x3C;exclusions paths, wildcards ok> \</span></span>
<span class="line"><span style="color: #c9d1d9">                                    -Dsonar.java.binaries=&#x3C;java binaries paths, no wildcards> \</span></span>
<span class="line"><span style="color: #c9d1d9">				    -Dsonar.java.libraries=&#x3C;java libraries paths, wildcards ok> \</span></span>
<span class="line"><span style="color: #c9d1d9">				    -Dsonar.junit.reportPaths=&#x3C;surefire report paths, wildcards ok></span></span>
<span class="line"><span style="color: #c9d1d9">                                """</span></span>
<span class="line"><span style="color: #c9d1d9">                            }</span></span>
<span class="line"><span style="color: #c9d1d9">                        }</span></span>
<span class="line"><span style="color: #c9d1d9">                   }</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span></code></pre>
<h1 id="archive-buildtest-artifacts">Archive build/test artifacts</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">    post {</span></span>
<span class="line"><span style="color: #c9d1d9">        always {</span></span>
<span class="line"><span style="color: #c9d1d9">            archiveArtifacts artifacts: 'build/libs/**/*.jar', fingerprint: true</span></span>
<span class="line"><span style="color: #c9d1d9">            junit 'build/reports/**/*.xml'</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span>
<span class="line"><span style="color: #c9d1d9">    }</span></span></code></pre>
<h1 id="sending-notification-to-email--slack">Sending notification to Email / Slack</h1>
<p>Requires Email-ext and Slack plugins</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">    post {</span></span>
<span class="line"><span style="color: #c9d1d9">        always {</span></span>
<span class="line"><span style="color: #c9d1d9">	    script {</span></span>
<span class="line"><span style="color: #c9d1d9">                if (currentBuild.currentResult == 'SUCCESS') {</span></span>
<span class="line"><span style="color: #c9d1d9">                    env.SLACKCOLOR = "good"</span></span>
<span class="line"><span style="color: #c9d1d9">                } else {</span></span>
<span class="line"><span style="color: #c9d1d9">                    env.SLACKCOLOR = "danger"</span></span>
<span class="line"><span style="color: #c9d1d9">                }</span></span>
<span class="line"><span style="color: #c9d1d9">                env.GITCOMMIT = sh(returnStdout:true, script: 'git rev-parse HEAD | cut -c 1-6').trim()</span></span>
<span class="line"><span style="color: #c9d1d9">                env.GITCOMMITUSER = sh(returnStdout:true, script: "git --no-pager show -s --format='%an' ${env.GITCOMMIT}").trim()</span></span>
<span class="line"><span style="color: #c9d1d9">                env.GITCOMMITMSG = sh(returnStdout: true, script: 'git log -1 --pretty=%B').trim()</span></span>
<span class="line"><span style="color: #c9d1d9"></span></span>
<span class="line"><span style="color: #c9d1d9">                env.SLACKMSG = """</span></span>
<span class="line"><span style="color: #c9d1d9">                    *${currentBuild.currentResult}: &#x3C;${env.BUILD_URL}|${env.JOB_NAME} #${env.BUILD_NUMBER}>*</span></span>
<span class="line"><span style="color: #c9d1d9">                    commit ${env.GITCOMMIT} ${env.GITCOMMITMSG}</span></span>
<span class="line"><span style="color: #c9d1d9">                    by ${env.GITCOMMITUSER} on branch ${env.BRANCH_NAME}</span></span>
<span class="line"><span style="color: #c9d1d9">                    """</span></span>
<span class="line"><span style="color: #c9d1d9"></span></span>
<span class="line"><span style="color: #c9d1d9">                env.EMAILMSG = """</span></span>
<span class="line"><span style="color: #c9d1d9">                    ${currentBuild.currentResult}: ${env.JOB_NAME} #${env.BUILD_NUMBER}:</span></span>
<span class="line"><span style="color: #c9d1d9">                    Commit ${env.GITCOMMIT} ${env.GITCOMMITMSG}</span></span>
<span class="line"><span style="color: #c9d1d9">                            by ${env.GITCOMMITUSER} on branch ${env.BRANCH_NAME}</span></span>
<span class="line"><span style="color: #c9d1d9"></span></span>
<span class="line"><span style="color: #c9d1d9">                            Check console output at ${env.BUILD_URL} to view the results</span></span>
<span class="line"><span style="color: #c9d1d9">                    """</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9"></span></span>
<span class="line"><span style="color: #c9d1d9">            slackSend (</span></span>
<span class="line"><span style="color: #c9d1d9">                message: "${env.SLACKMSG}",</span></span>
<span class="line"><span style="color: #c9d1d9">                color: "${env.SLACKCOLOR}",</span></span>
<span class="line"><span style="color: #c9d1d9">                baseUrl: "&#x3C;jenkins integration url from slack>",</span></span>
<span class="line"><span style="color: #c9d1d9">                channel: "#&#x3C;channel>",</span></span>
<span class="line"><span style="color: #c9d1d9">                tokenCredentialId: "&#x3C;jenkins credId>"</span></span>
<span class="line"><span style="color: #c9d1d9">                )</span></span>
<span class="line"><span style="color: #c9d1d9">    	}</span></span>
<span class="line"><span style="color: #c9d1d9">        failure {</span></span>
<span class="line"><span style="color: #c9d1d9">            emailext (</span></span>
<span class="line"><span style="color: #c9d1d9">                to: "&#x3C;email addresses>",</span></span>
<span class="line"><span style="color: #c9d1d9">                subject: "FAIL: ${env.JOB_NAME} #${env.BUILD_NUMBER}",</span></span>
<span class="line"><span style="color: #c9d1d9">                body: "${env.EMAILMSG}"</span></span>
<span class="line"><span style="color: #c9d1d9">                )</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span>
<span class="line"><span style="color: #c9d1d9">    }</span></span></code></pre>
<h1 id="invoke-owasp-dependency-check-scan">Invoke OWASP Dependency Check scan</h1>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">        stage('dependency-check') {</span></span>
<span class="line"><span style="color: #c9d1d9">            steps {</span></span>
<span class="line"><span style="color: #c9d1d9">                dependencyCheckAnalyzer scanpath: '',</span></span>
<span class="line"><span style="color: #c9d1d9">                    outdir: '.',</span></span>
<span class="line"><span style="color: #c9d1d9">                    datadir: '',</span></span>
<span class="line"><span style="color: #c9d1d9">                    suppressionFile: '',</span></span>
<span class="line"><span style="color: #c9d1d9">                    hintsFile: '',</span></span>
<span class="line"><span style="color: #c9d1d9">                    zipExtensions: '',</span></span>
<span class="line"><span style="color: #c9d1d9">                    isAutoupdateDisabled: false,</span></span>
<span class="line"><span style="color: #c9d1d9">                    includeHtmlReports: true,</span></span>
<span class="line"><span style="color: #c9d1d9">                    includeVulnReports: false,</span></span>
<span class="line"><span style="color: #c9d1d9">                    includeJsonReports: false,</span></span>
<span class="line"><span style="color: #c9d1d9">                    includeCsvReports: false,</span></span>
<span class="line"><span style="color: #c9d1d9">                    skipOnScmChange: false,</span></span>
<span class="line"><span style="color: #c9d1d9">                    skipOnUpstreamChange: false</span></span>
<span class="line"><span style="color: #c9d1d9"></span></span>
<span class="line"><span style="color: #c9d1d9">                dependencyCheckPublisher canComputeNew: false, defaultEncoding: '', healthy: '', pattern: '', unHealthy: ''</span></span>
<span class="line"><span style="color: #c9d1d9">            }</span></span>
<span class="line"><span style="color: #c9d1d9">        }</span></span></code></pre>
			</div>
		</div>
	</article>
				</main>
				<div class="container flex flex-col items-center max-w-3xl px-6 mx-auto xl:max-w-5xl">
	<div class="flex space-x-4">
		<a target="_blank" href="https://twitter.com/geksiong">
				<span class="sr-only">twitter</span>
				<svg viewBox="0 0 24 24" class="w-8 hover:text-main" astro-icon="tabler:brand-twitter"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
			</a><a target="_blank" href="https://github.com/geksiong">
				<span class="sr-only">github</span>
				<svg viewBox="0 0 24 24" class="w-8 hover:text-main" astro-icon="tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
			</a>
	</div>
</div>

		<footer class="container flex flex-col max-w-3xl px-6 pt-6 mx-auto md:flex-row md:place-content-between xl:max-w-5xl text-darkshade bg-lightshade">
			<p>Built with
				<a target="_blank" href="https://www.astro.build">
					<svg viewBox="0 0 32 32" class="inline w-6 text-darkshade hover:text-main" astro-icon="vscode-icons:file-type-astro"><path fill="#ff5d01" fill-rule="evenodd" d="M5.9 18.847a7.507 7.507 0 0 0-.572 2.624 3.265 3.265 0 0 0 .551 1.553 7.427 7.427 0 0 0 2.093 1.681l5.128 3.414a7.332 7.332 0 0 0 2.1 1.168 3.239 3.239 0 0 0 1.5 0 7.381 7.381 0 0 0 2.117-1.16L24 24.711a7.512 7.512 0 0 0 2.117-1.688 3.241 3.241 0 0 0 .55-1.563 7.515 7.515 0 0 0-.587-2.643L21.547 4.551a3.973 3.973 0 0 0-.54-1.3 1.733 1.733 0 0 0-.7-.51 3.972 3.972 0 0 0-1.4-.122h-5.902a3.932 3.932 0 0 0-1.4.125 1.713 1.713 0 0 0-.7.512 3.94 3.94 0 0 0-.535 1.3L5.9 18.848zm13.24-13.2a3.329 3.329 0 0 1 .441 1.093l3.892 12.784a16.168 16.168 0 0 0-4.653-1.573l-2.529-8.56a.331.331 0 0 0-.513-.169.323.323 0 0 0-.119.169l-2.5 8.557a16.14 16.14 0 0 0-4.674 1.579l3.908-12.784a3.281 3.281 0 0 1 .442-1.094 1.458 1.458 0 0 1 .582-.43 3.31 3.31 0 0 1 1.175-.1h2.793a3.314 3.314 0 0 1 1.176.1 1.454 1.454 0 0 1 .583.432zM16.127 21.06a5.551 5.551 0 0 0 3.4-.923 2.8 2.8 0 0 1-.207 2.182 3.938 3.938 0 0 1-1.547 1.481c-.674.428-1.254.8-1.254 1.787a2.079 2.079 0 0 0 .209.914 2.49 2.49 0 0 1-1.535-2.3v-.061c0-.683 0-1.524-.962-1.524a1.028 1.028 0 0 0-.391.077 1.021 1.021 0 0 0-.552.551 1.03 1.03 0 0 0-.079.391 3.769 3.769 0 0 1-.988-2.644 4.206 4.206 0 0 1 .175-1.248c.4.757 1.92 1.32 3.731 1.32z"/></svg>
				</a>
				and
				<a target="_blank" href="https://www.tailwindcss.com">
					<svg viewBox="0 0 32 32" class="inline w-6 text-darkshade hover:text-main" astro-icon="vscode-icons:file-type-tailwind"><path fill="#44a8b3" d="M9 13.7q1.4-5.6 7-5.6c5.6 0 6.3 4.2 9.1 4.9q2.8.7 4.9-2.1-1.4 5.6-7 5.6c-5.6 0-6.3-4.2-9.1-4.9q-2.8-.7-4.9 2.1zm-7 8.4q1.4-5.6 7-5.6c5.6 0 6.3 4.2 9.1 4.9q2.8.7 4.9-2.1-1.4 5.6-7 5.6c-5.6 0-6.3-4.2-9.1-4.9q-2.8-.7-4.9 2.1z"/></svg>
				</a>
			</p>
			<p>© 2022 GS Low. All views expressed are personal.</p>
		</footer>
			</div>
		</div>
  </body></html>